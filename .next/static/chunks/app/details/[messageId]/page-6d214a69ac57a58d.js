(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{2751:(e,t,o)=>{"use strict";o.d(t,{A:()=>n});var r=o(2115),s=o(4386);let n=()=>{let e=(0,r.useContext)(s.U);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}},4386:(e,t,o)=>{"use strict";o.d(t,{U:()=>l,k:()=>c});var r=o(5155),s=o(2115),n=o(9675);let i="/api",a=async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=arguments.length>2?arguments[2]:void 0;try{console.log("Sending request to API:",{query:e,streaming:t});let r={query:e,streaming:t},s=JSON.stringify(r);console.log("Payload object:",r),console.log("Request URL:","".concat(i,"/ai-assistant"));let n=await fetch("".concat(i,"/ai-assistant"),{method:"POST",headers:{"Content-Type":"application/json",Accept:t?"text/event-stream":"application/json"},body:s});if(console.log("Response status:",n.status),!n.ok){let e=await n.text();throw console.error("API error response:",e),Error("API call failed with status: ".concat(n.status," - ").concat(e))}if(t&&n.body){let e=n.body.getReader(),t=new TextDecoder,r="",s="";for(;;){let{done:n,value:i}=await e.read();if(n)break;let a=t.decode(i,{stream:!0});if(r+=a,o)try{let e=r.indexOf('"answer"');if(-1!==e){let t=r.indexOf('"',e+8)+1;if(t>0){let e="",n=t,i=!1;for(;n<r.length;){let t=r[n];if(i)"n"===t?e+="\n":"t"===t?e+="	":"r"===t?e+="\r":e+=t,i=!1;else if("\\"===t)i=!0;else if('"'===t)break;else e+=t;n++}if(e.length>s.length){let t=e.slice(s.length);s=e,o(t)}}else o("")}else o(a)}catch(e){o(a)}}try{let e=JSON.parse(r.trim());return console.log("API response data:",e),e}catch(t){let e=r.match(/\{[\s\S]*\}/);if(e)try{let t=JSON.parse(e[0]);return console.log("API response data (extracted):",t),t}catch(e){}return{keywords:[],matched_tables:[],related_tables:[],matched_columns:{},is_query_generated:!1,sql_query:"",sql_prompt:"",answer:r.trim()}}}{let e=await n.json();return console.log("API response data:",e),e}}catch(e){throw console.error("Error sending message to AI:",e),e}},l=(0,s.createContext)(void 0),d="quantara_chat_history",c=e=>{let{children:t}=e,[o,i]=(0,s.useState)([]),[c,h]=(0,s.useState)(!1),[x,m]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{{let e=localStorage.getItem(d);if(e)try{i(JSON.parse(e))}catch(e){console.error("Failed to parse saved messages:",e)}p(!0)}},[]),(0,s.useEffect)(()=>{u&&localStorage.setItem(d,JSON.stringify(o))},[o,u]);let g=async e=>{h(!0),m(null);let t={id:(0,n.A)(),role:"user",content:e,timestamp:Date.now()};i(e=>[...e,t]);try{let t=await a(e,!1);console.log("API Response received:",t);let o={id:(0,n.A)(),role:"ai",content:t.answer||"Received response but 'answer' field was empty. Click for details.",timestamp:Date.now(),apiResponse:t};i(e=>[...e,o])}catch(e){m(e instanceof Error?e.message:"An unknown error occurred")}finally{h(!1)}};return(0,r.jsx)(l.Provider,{value:{messages:o,isLoading:c,error:x,sendMessage:g,clearHistory:()=>{i([]),localStorage.removeItem(d)}},children:t})}},5105:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>_});var r=o(5155);o(2115);var s=o(63),n=o(1574),i=o(3719),a=o(9488),l=o(7855),d=o(4193),c=o(6541),h=o(2347),x=o(6408),m=o(8808),u=o(2397);o(6105);var p=o(2751),g=o(539),b=o(4627);let f=e=>{let{title:t,children:o}=e;return(0,r.jsx)(g.A,{variant:"outlined",sx:{mb:2,borderRadius:2},children:(0,r.jsxs)(b.A,{children:[(0,r.jsx)(a.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{textTransform:"uppercase",fontWeight:"bold"},children:t}),(0,r.jsx)(n.A,{sx:{mt:1},children:o})]})})},y=e=>{let{code:t}=e;return(0,r.jsx)(n.A,{component:"pre",sx:{p:2,borderRadius:2,bgcolor:"background.default",overflowX:"auto",my:0,fontFamily:"monospace",fontSize:"0.875rem",border:1,borderColor:"divider"},children:t})};function _(){let e=(0,s.useParams)(),t=(0,s.useRouter)(),{messages:o}=(0,p.A)(),g=e.messageId,b=o.find(e=>e.id===g);if(!b||!b.apiResponse)return(0,r.jsx)(n.A,{sx:{height:"100vh",width:"100%",bgcolor:"background.default",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:"#2B1348 #12081F","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"#12081F"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#2B1348",borderRadius:"3px","&:hover":{backgroundColor:"#6D5CFF"}}},children:(0,r.jsxs)(i.A,{maxWidth:"md",sx:{mt:4},children:[(0,r.jsx)(a.A,{variant:"h6",children:"Response not found."}),(0,r.jsx)(l.A,{startIcon:(0,r.jsx)(c.A,{}),onClick:()=>t.push("/chat"),children:"Back to Chat"})]})});let{apiResponse:_}=b;return(0,r.jsx)(n.A,{sx:{height:"100vh",width:"100%",bgcolor:"background.default",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:"#2B1348 #12081F","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"#12081F"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#2B1348",borderRadius:"3px","&:hover":{backgroundColor:"#6D5CFF"}}},children:(0,r.jsxs)(i.A,{maxWidth:"md",sx:{py:4},children:[(0,r.jsxs)(n.A,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(l.A,{startIcon:(0,r.jsx)(c.A,{}),onClick:()=>t.push("/chat"),children:"Back"}),(0,r.jsx)(a.A,{variant:"h5",fontWeight:"bold",children:"Response Details"})]}),(void 0!==_.total_time_in_sec||_.node_timings&&_.node_timings.length>0)&&(0,r.jsx)(f,{title:"Performance Summary",children:(0,r.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[void 0!==_.total_time_in_sec&&(0,r.jsxs)(n.A,{sx:{p:2,borderRadius:1,bgcolor:"primary.main",color:"primary.contrastText",textAlign:"center"},children:[(0,r.jsx)(a.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Total Execution Time"}),(0,r.jsxs)(a.A,{variant:"h4",fontWeight:"bold",children:[_.total_time_in_sec.toFixed(3),"s"]}),(0,r.jsxs)(a.A,{variant:"body2",sx:{mt:1,opacity:.9},children:[(_.total_time_in_sec/60).toFixed(2)," minutes"]})]}),_.node_timings&&_.node_timings.length>0&&(0,r.jsxs)(n.A,{children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"text.secondary",gutterBottom:!0,children:"Node Breakdown:"}),(0,r.jsx)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1,mt:1},children:_.node_timings.map((e,t)=>(0,r.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,borderRadius:1,bgcolor:"action.hover"},children:[(0,r.jsx)(a.A,{variant:"body2",children:e.name}),(0,r.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"primary",children:void 0!==e.time_sec?"".concat(e.time_sec.toFixed(2),"s"):"N/A"}),_.total_time_in_sec&&void 0!==e.time_sec&&(0,r.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:["(",(e.time_sec/_.total_time_in_sec*100).toFixed(1),"%)"]})]})]},t))})]})]})}),(0,r.jsx)(f,{title:"Extracted Keywords",children:(0,r.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:_.keywords.map((e,t)=>(0,r.jsx)(d.A,{label:e,size:"small",variant:"outlined"},t))})}),(0,r.jsx)(f,{title:"Matched Tables",children:(0,r.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:_.matched_tables.map((e,t)=>(0,r.jsx)(d.A,{label:e,color:"secondary",size:"small"},t))})}),(0,r.jsx)(f,{title:"Matched Columns",children:Object.entries(_.matched_columns).map(e=>{let[t,o]=e;return(0,r.jsxs)(n.A,{sx:{mb:1},children:[(0,r.jsxs)(a.A,{variant:"body2",fontWeight:"bold",color:"text.secondary",children:[t,":"]}),(0,r.jsx)(a.A,{variant:"body2",children:o.join(", ")})]},t)})}),(0,r.jsx)(f,{title:"SQL Prompt",children:(0,r.jsx)(y,{code:_.sql_prompt})}),(0,r.jsx)(f,{title:"Generated SQL Query",children:(0,r.jsx)(y,{code:_.sql_query})}),(0,r.jsx)(f,{title:"Final Answer",children:(0,r.jsx)(n.A,{sx:{"& p":{margin:"0 0 0.75rem 0","&:last-child":{marginBottom:0}},"& h1, & h2, & h3, & h4, & h5, & h6":{margin:"0.5rem 0 0.75rem 0",fontWeight:600,"&:first-of-type":{marginTop:0}},"& ul, & ol":{margin:"0.5rem 0",paddingLeft:"1.5rem"},"& li":{margin:"0.25rem 0"},"& code":{backgroundColor:"rgba(0, 0, 0, 0.1)",padding:"0.2rem 0.4rem",borderRadius:"0.25rem",fontSize:"0.9em",fontFamily:"monospace"},"& pre":{backgroundColor:"rgba(0, 0, 0, 0.1)",padding:"1rem",borderRadius:"0.5rem",overflow:"auto",margin:"0.75rem 0","& code":{backgroundColor:"transparent",padding:0}},"& table":{borderCollapse:"collapse",width:"100%",margin:"0.75rem 0"},"& th, & td":{border:"1px solid rgba(0, 0, 0, 0.2)",padding:"0.5rem"},"& th":{backgroundColor:"rgba(0, 0, 0, 0.1)"}},children:(0,r.jsx)(h.oz,{remarkPlugins:[x.A,m.A],rehypePlugins:[u.A],children:_.answer})})}),_.intent&&(0,r.jsxs)(f,{title:"Intent",children:[(0,r.jsxs)(n.A,{sx:{mb:2},children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"text.secondary",gutterBottom:!0,children:"Intent Type:"}),(0,r.jsx)(d.A,{label:_.intent,color:"primary",size:"small",sx:{mb:2}})]}),_.intent_reasoning&&(0,r.jsxs)(n.A,{children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"text.secondary",gutterBottom:!0,children:"Reasoning:"}),(0,r.jsx)(a.A,{variant:"body2",children:_.intent_reasoning})]})]}),_.node_timings&&_.node_timings.length>0&&(0,r.jsx)(f,{title:"Node Timings",children:(0,r.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[_.node_timings.map((e,t)=>(0,r.jsxs)(n.A,{sx:{p:1.5,borderRadius:1,bgcolor:e.success?"action.hover":"error.light",border:1,borderColor:e.success?"success.main":"error.main"},children:[(0,r.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",children:e.name}),(0,r.jsx)(d.A,{label:e.success?"Success":"Failed",color:e.success?"success":"error",size:"small"})]}),(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Time: ",void 0!==e.time_sec?"".concat(e.time_sec.toFixed(2),"s (").concat((1e3*e.time_sec).toFixed(2),"ms)"):"N/A"]})]},t)),void 0!==_.total_time_in_sec&&(0,r.jsx)(n.A,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:(0,r.jsxs)(a.A,{variant:"body2",fontWeight:"bold",color:"primary",children:["Total Time: ",_.total_time_in_sec.toFixed(3),"s"]})})]})}),_.workflow_tokens&&_.workflow_tokens.length>0&&(0,r.jsx)(f,{title:"Token Usage",children:(0,r.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[_.workflow_tokens.map((e,t)=>(0,r.jsxs)(n.A,{sx:{p:1.5,borderRadius:1,bgcolor:"action.hover",border:1,borderColor:"divider"},children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:e.name}),(0,r.jsxs)(n.A,{sx:{display:"flex",gap:2},children:[(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Input: ",e.input_tokens.toLocaleString()," tokens"]}),(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Output: ",e.output_tokens.toLocaleString()," tokens"]}),(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Total: ",(e.input_tokens+e.output_tokens).toLocaleString()," tokens"]})]})]},t)),(void 0!==_.total_input_tokens||void 0!==_.total_output_tokens)&&(0,r.jsxs)(n.A,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[(0,r.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"primary",gutterBottom:!0,children:"Total Tokens:"}),(0,r.jsxs)(n.A,{sx:{display:"flex",gap:2},children:[void 0!==_.total_input_tokens&&(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Input: ",_.total_input_tokens.toLocaleString()," tokens"]}),void 0!==_.total_output_tokens&&(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Output: ",_.total_output_tokens.toLocaleString()," tokens"]}),void 0!==_.total_input_tokens&&void 0!==_.total_output_tokens&&(0,r.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["Grand Total: ",(_.total_input_tokens+_.total_output_tokens).toLocaleString()," tokens"]})]})]})]})})]})})}},7685:(e,t,o)=>{Promise.resolve().then(o.bind(o,5105))}},e=>{e.O(0,[682,330,263,608,384,855,933,441,255,358],()=>e(e.s=7685)),_N_E=e.O()}]);