(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{2751:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(2115),a=s(4386);let o=()=>{let e=(0,r.useContext)(a.U);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}},4386:(e,t,s)=>{"use strict";s.d(t,{U:()=>i,k:()=>d});var r=s(5155),a=s(2115),o=s(9675);let n="/api",l=async e=>{try{console.log("Sending request to API:",{query:e});let t={query:e},s=JSON.stringify(t);console.log("Payload object:",t),console.log("Payload stringified:",s),console.log("Request URL:","".concat(n,"/ai-assistant"));let r=await fetch("".concat(n,"/ai-assistant"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:s});if(console.log("Response status:",r.status),!r.ok){let e=await r.text();throw console.error("API error response:",e),Error("API call failed with status: ".concat(r.status," - ").concat(e))}let a=await r.json();return console.log("API response data:",a),a}catch(e){throw console.error("Error sending message to AI:",e),e}},i=(0,a.createContext)(void 0),c="quantara_chat_history",d=e=>{let{children:t}=e,[s,n]=(0,a.useState)(()=>{let e=localStorage.getItem(c);return e?JSON.parse(e):[]}),[d,h]=(0,a.useState)(!1),[u,x]=(0,a.useState)(null);(0,a.useEffect)(()=>{localStorage.setItem(c,JSON.stringify(s))},[s]);let p=async e=>{h(!0),x(null);let t={id:(0,o.A)(),role:"user",content:e,timestamp:Date.now()};n(e=>[...e,t]);try{let t=await l(e);console.log("API Response received:",t);let s={id:(0,o.A)(),role:"ai",content:t.answer||"Received response but 'answer' field was empty. Click for details.",timestamp:Date.now(),apiResponse:t};n(e=>[...e,s])}catch(e){x(e instanceof Error?e.message:"An unknown error occurred")}finally{h(!1)}};return(0,r.jsx)(i.Provider,{value:{messages:s,isLoading:d,error:u,sendMessage:p,clearHistory:()=>{n([]),localStorage.removeItem(c)}},children:t})}},5105:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var r=s(5155);s(2115);var a=s(63),o=s(1574),n=s(3719),l=s(9488),i=s(7855),c=s(4193),d=s(6541),h=s(2751),u=s(539),x=s(4627);let p=e=>{let{title:t,children:s}=e;return(0,r.jsx)(u.A,{variant:"outlined",sx:{mb:2,borderRadius:2},children:(0,r.jsxs)(x.A,{children:[(0,r.jsx)(l.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{textTransform:"uppercase",fontWeight:"bold"},children:t}),(0,r.jsx)(o.A,{sx:{mt:1},children:s})]})})},m=e=>{let{code:t}=e;return(0,r.jsx)(o.A,{component:"pre",sx:{p:2,borderRadius:2,bgcolor:"background.default",overflowX:"auto",my:0,fontFamily:"monospace",fontSize:"0.875rem",border:1,borderColor:"divider"},children:t})};function j(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),{messages:s}=(0,h.A)(),u=e.messageId,x=s.find(e=>e.id===u);if(!x||!x.apiResponse)return(0,r.jsxs)(n.A,{maxWidth:"md",sx:{mt:4},children:[(0,r.jsx)(l.A,{variant:"h6",children:"Response not found."}),(0,r.jsx)(i.A,{startIcon:(0,r.jsx)(d.A,{}),onClick:()=>t.push("/chat"),children:"Back to Chat"})]});let{apiResponse:j}=x;return(0,r.jsxs)(n.A,{maxWidth:"md",sx:{py:4},children:[(0,r.jsxs)(o.A,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(i.A,{startIcon:(0,r.jsx)(d.A,{}),onClick:()=>t.push("/chat"),children:"Back"}),(0,r.jsx)(l.A,{variant:"h5",fontWeight:"bold",children:"Response Details"})]}),(0,r.jsx)(p,{title:"Extracted Keywords",children:(0,r.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:j.keywords.map((e,t)=>(0,r.jsx)(c.A,{label:e,size:"small",variant:"outlined"},t))})}),(0,r.jsx)(p,{title:"Matched Tables",children:(0,r.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:j.matched_tables.map((e,t)=>(0,r.jsx)(c.A,{label:e,color:"secondary",size:"small"},t))})}),(0,r.jsx)(p,{title:"Matched Columns",children:Object.entries(j.matched_columns).map(e=>{let[t,s]=e;return(0,r.jsxs)(o.A,{sx:{mb:1},children:[(0,r.jsxs)(l.A,{variant:"body2",fontWeight:"bold",color:"text.secondary",children:[t,":"]}),(0,r.jsx)(l.A,{variant:"body2",children:s.join(", ")})]},t)})}),(0,r.jsx)(p,{title:"SQL Prompt",children:(0,r.jsx)(m,{code:j.sql_prompt})}),(0,r.jsx)(p,{title:"Generated SQL Query",children:(0,r.jsx)(m,{code:j.sql_query})}),(0,r.jsx)(p,{title:"Final Answer",children:(0,r.jsx)(l.A,{variant:"body1",children:j.answer})})]})}},7685:(e,t,s)=>{Promise.resolve().then(s.bind(s,5105))}},e=>{e.O(0,[263,608,855,127,441,255,358],()=>e(e.s=7685)),_N_E=e.O()}]);