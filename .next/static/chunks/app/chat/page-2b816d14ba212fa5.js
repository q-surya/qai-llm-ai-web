(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2751:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var o=t(2115),i=t(4386);let l=()=>{let e=(0,o.useContext)(i.U);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}},2842:(e,r,t)=>{Promise.resolve().then(t.bind(t,5154))},4386:(e,r,t)=>{"use strict";t.d(r,{U:()=>a,k:()=>c});var o=t(5155),i=t(2115),l=t(9675);let s="/api",n=async function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=arguments.length>2?arguments[2]:void 0;try{console.log("Sending request to API:",{query:e,streaming:r});let o={query:e,streaming:r},i=JSON.stringify(o);console.log("Payload object:",o),console.log("Request URL:","".concat(s,"/ai-assistant"));let l=await fetch("".concat(s,"/ai-assistant"),{method:"POST",headers:{"Content-Type":"application/json",Accept:r?"text/event-stream":"application/json"},body:i});if(console.log("Response status:",l.status),!l.ok){let e=await l.text();throw console.error("API error response:",e),Error("API call failed with status: ".concat(l.status," - ").concat(e))}if(r&&l.body){let e=l.body.getReader(),r=new TextDecoder,o="",i="";for(;;){let{done:l,value:s}=await e.read();if(l)break;let n=r.decode(s,{stream:!0});if(o+=n,t)try{let e=o.indexOf('"answer"');if(-1!==e){let r=o.indexOf('"',e+8)+1;if(r>0){let e="",l=r,s=!1;for(;l<o.length;){let r=o[l];if(s)"n"===r?e+="\n":"t"===r?e+="	":"r"===r?e+="\r":e+=r,s=!1;else if("\\"===r)s=!0;else if('"'===r)break;else e+=r;l++}if(e.length>i.length){let r=e.slice(i.length);i=e,t(r)}}else t("")}else t(n)}catch(e){t(n)}}try{let e=JSON.parse(o.trim());return console.log("API response data:",e),e}catch(r){let e=o.match(/\{[\s\S]*\}/);if(e)try{let r=JSON.parse(e[0]);return console.log("API response data (extracted):",r),r}catch(e){}return{is_query_generated:!1,sql_query:"",sql_prompt:"",answer:o.trim()}}}{let e=await l.json();return console.log("API response data:",e),e}}catch(e){throw console.error("Error sending message to AI:",e),e}},a=(0,i.createContext)(void 0),d="quantara_chat_history",c=e=>{let{children:r}=e,[t,s]=(0,i.useState)([]),[c,x]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[u,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{{let e=localStorage.getItem(d);if(e)try{s(JSON.parse(e))}catch(e){console.error("Failed to parse saved messages:",e)}m(!0)}},[]),(0,i.useEffect)(()=>{u&&localStorage.setItem(d,JSON.stringify(t))},[t,u]);let g=async e=>{x(!0),p(null);let r={id:(0,l.A)(),role:"user",content:e,timestamp:Date.now()};s(e=>[...e,r]);try{let r=await n(e,!1);console.log("API Response received:",r);let t={id:(0,l.A)(),role:"ai",content:r.answer||"Received response but 'answer' field was empty. Click for details.",timestamp:Date.now(),apiResponse:r};s(e=>[...e,t])}catch(e){p(e instanceof Error?e.message:"An unknown error occurred")}finally{x(!1)}};return(0,o.jsx)(a.Provider,{value:{messages:t,isLoading:c,error:h,sendMessage:g,clearHistory:()=>{s([]),localStorage.removeItem(d)}},children:r})}},5154:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var o=t(5155),i=t(2115),l=t(1574),s=t(9488),n=t(3719),a=t(8638),d=t(2751),c=t(63),x=t(2347),h=t(8808),p=t(6408),u=t(2397);t(6105);let m=e=>{let{message:r,isLoading:t=!1}=e,i=(0,c.useRouter)(),n="user"===r.role,a="ai"===r.role;return a&&t&&(!r.content||""===r.content.trim())?null:(0,o.jsx)(l.A,{display:"flex",justifyContent:n?"flex-end":"flex-start",mb:3,sx:{width:"100%"},children:(0,o.jsxs)(l.A,{onClick:()=>{a&&r.apiResponse&&i.push("/details/".concat(r.id))},sx:{maxWidth:{xs:"85%",sm:"80%"},px:{xs:2.5,md:3},py:{xs:1.5,md:2},borderRadius:"1.5rem",bgcolor:n?"#6D5CFF":"#1E0C34",color:"#F2ECF8",fontSize:{xs:"0.95rem",md:"1rem"},lineHeight:1.6,boxShadow:"0 2px 5px rgba(0,0,0,0.2)",border:a?"1px solid":"none",borderColor:a?"#2B1348":"transparent",cursor:a&&!t&&r.apiResponse?"pointer":"default",transition:"all 0.2s ease","&:hover":a&&!t&&r.apiResponse?{bgcolor:"#2B1348",transform:"translateY(-1px)"}:{}},children:[a?(0,o.jsx)(l.A,{sx:{color:"#F2ECF8","& p":{margin:"0 0 0.75rem 0","&:last-child":{marginBottom:0}},"& h1, & h2, & h3, & h4, & h5, & h6":{margin:"0.5rem 0 0.75rem 0",color:"#F2ECF8",fontWeight:600,"&:first-of-type":{marginTop:0}},"& h1":{fontSize:"1.5rem"},"& h2":{fontSize:"1.3rem"},"& h3":{fontSize:"1.1rem"},"& ul, & ol":{margin:"0.5rem 0",paddingLeft:"1.5rem"},"& li":{margin:"0.25rem 0"},"& code":{backgroundColor:"rgba(0, 0, 0, 0.3)",padding:"0.2rem 0.4rem",borderRadius:"0.25rem",fontSize:"0.9em",fontFamily:"monospace"},"& pre":{backgroundColor:"rgba(0, 0, 0, 0.3)",padding:"1rem",borderRadius:"0.5rem",overflow:"auto",margin:"0.75rem 0","& code":{backgroundColor:"transparent",padding:0}},"& blockquote":{borderLeft:"3px solid #6D5CFF",paddingLeft:"1rem",margin:"0.75rem 0",fontStyle:"italic",opacity:.9},"& a":{color:"#6D5CFF",textDecoration:"underline"},"& table":{borderCollapse:"collapse",width:"100%",margin:"0.75rem 0"},"& th, & td":{border:"1px solid rgba(255, 255, 255, 0.2)",padding:"0.5rem"},"& th":{backgroundColor:"rgba(0, 0, 0, 0.2)"},"& .katex":{color:"#F2ECF8"},"& .katex .base":{color:"#F2ECF8"}},children:(0,o.jsx)(x.oz,{remarkPlugins:[p.A,h.A],rehypePlugins:[u.A],children:r.content||""},r.id)}):(0,o.jsx)(s.A,{variant:"body1",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",color:"#F2ECF8"},children:r.content}),a&&!t&&r.apiResponse&&(0,o.jsx)(s.A,{variant:"caption",display:"block",sx:{mt:1.5,color:"#A090B0",fontSize:"0.75rem",fontStyle:"italic"},children:"\uD83D\uDCA1 Click to view SQL details"})]})})};var g=t(2042),f=t(4288),b=t(4619);let y=e=>{let{onSend:r,isLoading:t}=e,[s,n]=(0,i.useState)(""),a=()=>{s.trim()&&!t&&(r(s.trim()),n(""))};return(0,o.jsxs)(l.A,{sx:{width:"100%",pt:2,pb:3,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,o.jsxs)(l.A,{sx:{position:"relative",width:"100%"},children:[(0,o.jsx)(g.A,{fullWidth:!0,placeholder:"Message Quantara...",multiline:!0,maxRows:1,value:s,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),a())},disabled:t,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{bgcolor:"#1E0C34",borderRadius:"30px",color:"#F2ECF8",pl:3,pr:7,height:"56px",alignItems:"center","& fieldset":{borderColor:"#2B1348"},"&:hover fieldset":{borderColor:"#6D5CFF"},"&.Mui-focused fieldset":{borderColor:"#6D5CFF",borderWidth:"1px"}}},inputProps:{style:{padding:0}}}),(0,o.jsx)(l.A,{sx:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",zIndex:2},children:(0,o.jsx)(f.A,{onClick:a,disabled:!s.trim()||t,sx:{background:s.trim()?"linear-gradient(135deg, #6D5CFF 0%, #B44BFF 100%)":"#2B1348",color:"#F2ECF8",width:"36px",height:"36px",opacity:s.trim()?1:.5,"&:hover":{background:s.trim()?"linear-gradient(135deg, #5844E0 0%, #9F33E6 100%)":"#2B1348"},transition:"all 0.2s"},children:(0,o.jsx)(b.A,{fontSize:"small"})})})]}),(0,o.jsx)(l.A,{sx:{mt:1.5,textAlign:"center",px:2},children:(0,o.jsx)(l.A,{component:"span",sx:{fontSize:"0.75rem",color:"#A090B0",display:"block"},children:"Quantara can make mistakes. Consider checking important information."})})]})};function v(){let{messages:e,isLoading:r,sendMessage:t}=(0,d.A)(),c=(0,i.useRef)(null),x=(0,i.useRef)(null);return(0,i.useEffect)(()=>{c.current&&x.current&&x.current.scrollTo({top:x.current.scrollHeight,behavior:"smooth"})},[e,r]),(0,i.useEffect)(()=>{let e=x.current;if(!e)return;let r=()=>{let r=e.scrollHeight-e.clientHeight;e.scrollTop>r&&(e.scrollTop=r)};return e.addEventListener("scroll",r,{passive:!0}),()=>e.removeEventListener("scroll",r)},[]),(0,o.jsxs)(l.A,{sx:{height:"100vh",width:"100%",bgcolor:"background.default",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,o.jsx)(l.A,{sx:{py:2,borderBottom:"1px solid",borderColor:"divider",textAlign:"center",bgcolor:"background.default",zIndex:10,flexShrink:0},children:(0,o.jsx)(s.A,{variant:"h6",fontWeight:600,color:"text.primary",children:"Quantara AI"})}),(0,o.jsx)(l.A,{ref:x,sx:{flexGrow:1,minHeight:0,overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:"#2B1348 #12081F",overscrollBehavior:"contain",position:"relative","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"#12081F"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#2B1348",borderRadius:"3px","&:hover":{backgroundColor:"#6D5CFF"}}},children:(0,o.jsxs)(n.A,{maxWidth:!1,sx:{maxWidth:{xs:"100%",md:"800px",lg:"900px"},width:"100%",px:{xs:2,md:0},py:{xs:2,md:4}},children:[0===e.length?(0,o.jsxs)(l.A,{sx:{mt:{xs:6,md:10},textAlign:"center",opacity:.7,px:2},children:[(0,o.jsx)(s.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,sx:{fontSize:{xs:"1.5rem",md:"2rem"}},children:"How can I help you today?"}),(0,o.jsx)(s.A,{variant:"body1",color:"text.secondary",sx:{mt:2},children:"Ask me anything about your data"})]}):e.map(t=>{var i;return(0,o.jsx)(m,{message:t,isLoading:r&&t.id===(null==(i=e[e.length-1])?void 0:i.id)},t.id)}),r&&(0,o.jsx)(l.A,{sx:{display:"flex",justifyContent:"flex-start",mb:2},children:(0,o.jsx)(l.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:2,border:"1px solid",borderColor:"#2B1348"},children:(0,o.jsx)(a.A,{size:20,sx:{color:"primary.main"}})})}),(0,o.jsx)("div",{ref:c,style:{height:"1px",flexShrink:0}})]})}),(0,o.jsx)(l.A,{sx:{flexShrink:0,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.default",py:2,position:"relative",zIndex:10},children:(0,o.jsx)(n.A,{maxWidth:!1,sx:{maxWidth:{xs:"100%",md:"800px",lg:"900px"},width:"100%",px:{xs:2,md:0}},children:(0,o.jsx)(y,{onSend:t,isLoading:r})})})]})}}},e=>{e.O(0,[682,330,263,608,384,355,441,255,358],()=>e(e.s=2842)),_N_E=e.O()}]);